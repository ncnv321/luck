<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="/index.css" rel="stylesheet" type="text/css" media="all" />
    <link href="/gallery.css" rel="stylesheet" type="text/css" media="all" />
    <link href="/mobile.css" rel="stylesheet" type="text/css" media="all" />
    <title>Art Gallery | luck</title>
    <link rel="icon" type="image/x-icon" href=" " />

    <!-- SimpleLightbox for image gallery -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/simplelightbox/2.12.1/simple-lightbox.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/simplelightbox/2.12.1/simple-lightbox.min.js"></script>

    <!-- Sanity Client Setup -->
    <script>
      // Include this script to load the ESM module
      window.global = window;
    </script>
    <script type="module">
      import { createClient } from "https://esm.sh/@sanity/client";
      window.createClient = createClient;
      // Signal that Sanity client is loaded
      window.sanityClientLoaded = true;
    </script>

    <!-- Centralized transitions -->
    <script src="/transitions.js"></script>

    <style>
      /* Critical styles for immediate application */
      .mainframe {
        overflow-y: scroll !important;
        height: 500px !important;
        width: 680px !important;
      }

      .sideframe {
        overflow-y: auto !important;
        overflow-x: hidden !important;
        height: 500px !important;
      }

      /* Special styling for right sideframe in art gallery only */
      .art-gallery-right-sideframe {
        width: 5px !important;
        border-left: none !important;
        background-color: black !important;
        opacity: 0 !important;
        pointer-events: none !important;
      }

      /* Ensure left sideframe is proper width */
      .left-sideframe {
        width: 175px !important;
      }

      /* IMPORTANT: Force dotted borders on sections */
      .left-section:not(.left-bottom-section) {
        border-bottom: 1px dashed white !important;
      }

      /* Force proper text spacing */
      p {
        margin-top: 0.5em !important;
        margin-bottom: 0.5em !important;
      }

      /* Year sections with forced dotted underlines */
      .year-section h2 {
        text-align: center !important;
        border-bottom: 1px dashed white !important;
        padding-bottom: 5px !important;
        margin: 20px 0 15px 0 !important;
      }

      /* Gallery title */
      .gallery-title {
        text-align: center !important;
        margin-bottom: 20px !important;
        font-size: 1.5em !important;
      }

      /* Filter box styles */
      .filters {
        margin: 10px 0 !important;
        padding: 10px !important;
        border: 1px dashed #666 !important;
        text-align: center !important;
        min-height: 100px !important;
      }

      /* Thumbnail grid layout */
      .thumbnail-grid {
        display: grid !important;
        grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)) !important;
        gap: 15px !important;
        margin-bottom: 25px !important;
      }

      /* Force thumbnail images to display properly */
      .thumbnail img {
        max-width: 90px !important;
        max-height: 90px !important;
        width: 100% !important;
        height: auto !important;
        aspect-ratio: 1 / 1 !important;
        object-fit: cover !important;
      }

      /* Loading indicator and error messages */
      .loading-indicator,
      .error-message {
        padding: 20px;
        text-align: center;
        color: white;
      }

      .error-message {
        color: #ff6b6b;
      }

      /* Header placeholder - Style if needed */
      .header02 {
        width: 438px;
        height: 215px;
        margin: 5px auto;
      }
    </style>

    <!-- Lightbox styling - improved z-index and caption visibility -->
    <style>
      /* Fix for banner overlapping lightbox */
      .sl-overlay {
        background: rgba(0, 0, 0, 0.8) !important;
        z-index: 10000 !important;
      }

      .sl-wrapper {
        z-index: 10001 !important;
      }

      .sl-image {
        z-index: 10002 !important;
      }

      .sl-close {
        z-index: 10003 !important;
      }

      .sl-navigation button {
        z-index: 10002 !important;
      }

      /* Force captions to be visible */
      .sl-caption {
        display: block !important;
        opacity: 1 !important;
        z-index: 10002 !important;
        background-color: rgba(0, 0, 0, 0.8) !important;
        color: white !important;
        padding: 15px !important;
        font-size: 14px !important;
        white-space: pre-line !important;
        max-width: 80% !important;
        margin: 0 auto !important;
        border-radius: 4px !important;
      }
    </style>
  </head>

  <body>
    <div class="header02">
      <a href="/"> <img src="" /> </a>
    </div>

    <div class="banner"></div>

    <main>
      <div class="mainwrapper">
        <!-- Keep the original flex layout structure to match other pages -->
        <div style="display: flex">
          <!-- Left sideframe -->
          <div class="sideframe left-sideframe">
            <div
              class="left-section left-top-section filter-section"
              style="border-bottom: 1px dashed white !important"
            >
              <center><h3 id="h3navmargins">Filters</h3></center>
              <div class="sidecontent">
                <section
                  class="filters"
                  style="
                    margin: 10px 0 !important;
                    padding: 10px !important;
                    border: 1px dashed #666 !important;
                    text-align: center !important;
                    min-height: 100px !important;
                  "
                >
                  <!-- Year filter -->
                  <div style="margin-bottom: 10px">
                    <label>Years:</label>
                    <select id="yearFilter">
                      <option value="all">All Years</option>
                      <option value="2025">2025</option>
                      <option value="2024">2024</option>
                      <option value="2023">2023</option>
                      <option value="2022">2022</option>
                      <option value="sketches">Sketches</option>
                    </select>
                  </div>

                  <!-- Medium filter -->
                  <div style="margin-bottom: 10px">
                    <label>Medium:</label>
                    <select id="mediumFilter">
                      <option value="all">All Mediums</option>
                      <option value="traditional">Traditional</option>
                      <option value="digital">Digital</option>
                      <option value="mix">Mix</option>
                    </select>
                  </div>

                  <!-- Character filter -->
                  <div style="margin-bottom: 10px">
                    <label>Character:</label>
                    <select id="characterFilter">
                      <option value="all">All Characters</option>
                      <option value="bnuuy">bnuuy</option>
                      <option value="fanart">fanart</option>
                    </select>
                  </div>

                  <!-- Apply filters button -->
                  <div style="margin-top: 10px">
                    <button
                      id="applyFilters"
                      style="
                        margin-top: 5px;
                        padding: 5px 10px;
                        background: #333;
                        color: white;
                        border: 1px solid white;
                        cursor: pointer;
                      "
                    >
                      Apply Filters
                    </button>
                  </div>
                </section>
              </div>
            </div>

            <div class="left-section left-bottom-section">
              <center></center>
              <div class="sidecontent">
                <center>
                  <div style="margin: 0px 0">
                    <a
                      href="/"
                      style="display: inline-block"
                      class="about-link"
                      title="Wah!"
                    >
                      <img
                        src="/bnuuy_closed.png"
                        alt="Home"
                        class="icon-default"
                        style="
                          width: 75px;
                          height: 103px;
                          vertical-align: middle;
                        "
                      />
                      <img
                        src="/bnuuy_open.png"
                        alt="Home Hover"
                        class="icon-hover"
                        style="
                          width: 75px;
                          height: 103px;
                          display: none;
                          vertical-align: middle;
                        "
                      />
                    </a>
                  </div>
                  <div
                    class="quick-links"
                    style="text-align: left; margin-top: 15px"
                  >
                    <p
                      style="
                        margin-top: 0.5em !important;
                        margin-bottom: 0.5em !important;
                      "
                    >
                      <img
                        src="/aboutmeee.png"
                        style="height: 15px"
                        alt="icon"
                      />
                      <a href="/aboutme.html">About me</a><br />
                      <img
                        src="/paperr.png"
                        style="height: 15px; vertical-align: middle"
                        alt="icon"
                      />
                      <a href="/journal.html">Journal</a><br />
                      <img
                        src="/musicc.png"
                        style="height: 15px; vertical-align: middle"
                        alt="icon"
                      />
                      <a href="/music.html">Music</a> <br />
                      <img
                        src="/chatt.png"
                        style="height: 15px; vertical-align: middle"
                        alt="icon"
                      />
                      <a
                        href="http://users.smartgb.com/g/g.php?a=s&i=g19-00984-40"
                        target="_blank"
                        >Guestbook</a
                      >
                    </p>
                  </div>
                </center>
              </div>
            </div>
          </div>

          <!-- Mainframe with wider width -->
          <div class="mainframe" style="width: 680px !important">
            <div class="maincontent gallery-content">
              <h2
                class="gallery-title"
                style="
                  text-align: center !important;
                  margin-bottom: 20px !important;
                  font-size: 1.5em !important;
                "
              >
                luck's art archive
              </h2>

              <section class="artworks">
                <div class="loading-indicator">Loading gallery...</div>
              </section>
            </div>
          </div>

          <!-- Camouflaged right sideframe (empty but preserves layout structure) -->
          <div class="sideframe art-gallery-right-sideframe">
            <!-- Intentionally empty -->
          </div>
        </div>
      </div>
    </main>
    <footer>
      <p id="paragraphstyling"><small> luck est. 2023 </small></p>
    </footer>

    <script>
      // Wait for Sanity client
      function waitForSanity(callback) {
        if (window.createClient) {
          callback();
        } else {
          console.log("Waiting for Sanity client to load...");
          setTimeout(() => waitForSanity(callback), 100);
        }
      }

      // Initialize gallery
      document.addEventListener("DOMContentLoaded", function () {
        waitForSanity(() => {
          // Get container
          const artworksContainer = document.querySelector(".artworks");

          try {
            // Create Sanity client
            const client = window.createClient({
              projectId: "asrslodd",
              dataset: "production",
              apiVersion: "2025-05-03",
              useCdn: true,
            });

            // Query to fetch artworks with all needed fields
            const query = `*[_type == "artwork"] {
              _id,
              title,
              "imageUrl": image.asset->url,
              year,
              description,
              category,
              medium,
              characters
            } | order(year desc)`;

            // Fetch artworks
            client
              .fetch(query)
              .then((artworks) => {
                // Store for filtering
                window.allArtworks = artworks;

                // Group by category
                const categories = {};
                artworks.forEach((artwork) => {
                  if (!categories[artwork.category]) {
                    categories[artwork.category] = [];
                  }
                  categories[artwork.category].push(artwork);
                });

                // Clear container
                artworksContainer.innerHTML = "";

                // Categories to display in order
                const orderedCategories = [
                  "2025",
                  "2024",
                  "2023",
                  "2022",
                  "sketches",
                ];

                // Create sections for each category
                orderedCategories.forEach((category) => {
                  if (
                    !categories[category] ||
                    categories[category].length === 0
                  ) {
                    return; // Skip empty categories
                  }

                  // Create year section
                  const yearSection = document.createElement("div");
                  yearSection.className = "year-section";
                  yearSection.id = `year-${category}`;

                  // Add header
                  const header = document.createElement("h2");
                  header.style.textAlign = "center";
                  header.style.borderBottom = "1px dashed white";
                  header.style.paddingBottom = "5px";
                  header.style.margin = "20px 0 15px 0";
                  header.textContent =
                    category === "sketches" ? "Sketches & Scraps" : category;
                  yearSection.appendChild(header);

                  // Create thumbnail grid
                  const thumbnailGrid = document.createElement("div");
                  thumbnailGrid.className = "thumbnail-grid";
                  thumbnailGrid.style.display = "grid";
                  thumbnailGrid.style.gridTemplateColumns =
                    "repeat(auto-fill, minmax(90px, 1fr))";
                  thumbnailGrid.style.gap = "15px";
                  thumbnailGrid.style.marginBottom = "25px";

                  // Add each artwork to the grid
                  categories[category].forEach((artwork) => {
                    const thumbnail = document.createElement("div");
                    thumbnail.className = "thumbnail";

                    const link = document.createElement("a");
                    link.href = artwork.imageUrl;

                    // Store the complete artwork data as a custom attribute
                    // (this will help us access it for the lightbox caption)
                    link.dataset.artworkJson = JSON.stringify({
                      id: artwork._id,
                      title: artwork.title,
                      description: artwork.description,
                      medium: artwork.medium,
                      characters: artwork.characters,
                    });

                    const image = document.createElement("img");
                    image.src = `${artwork.imageUrl}?w=90&h=90&fit=crop`;
                    image.alt = artwork.title || "Artwork";
                    image.title = artwork.title || "Artwork";
                    image.setAttribute("loading", "lazy");
                    image.style.maxWidth = "90px";
                    image.style.maxHeight = "90px";
                    image.style.width = "100%";
                    image.style.height = "auto";
                    image.style.aspectRatio = "1 / 1";
                    image.style.objectFit = "cover";

                    link.appendChild(image);
                    thumbnail.appendChild(link);
                    thumbnailGrid.appendChild(thumbnail);
                  });

                  yearSection.appendChild(thumbnailGrid);
                  artworksContainer.appendChild(yearSection);
                });

                // Set up filtering
                setupFilters();

                // Initialize custom lightbox
                initializeCustomLightbox(artworks);
              })
              .catch((error) => {
                console.error("Error fetching artworks:", error);
                artworksContainer.innerHTML =
                  '<div class="error-message">Error loading gallery. Please try again later.</div>';
              });
          } catch (error) {
            console.error("Exception in gallery script:", error);
            artworksContainer.innerHTML =
              '<div class="error-message">An error occurred while setting up the gallery. Please check the console for details.</div>';
          }
        });
      });

      // Custom lightbox initialization to ensure descriptions work
      function initializeCustomLightbox(artworks) {
        if (typeof SimpleLightbox === "undefined") {
          console.error("SimpleLightbox not available");
          return;
        }

        // If a previous instance exists, destroy it
        if (window.lightboxInstance) {
          window.lightboxInstance.destroy();
        }

        // Process links to ensure captions work
        document.querySelectorAll(".thumbnail a").forEach((link) => {
          try {
            // Get artwork data from our custom attribute
            const artworkData = JSON.parse(link.dataset.artworkJson || "{}");

            // Build caption content
            let captionText = "";

            // Add title
            if (artworkData.title) {
              captionText = artworkData.title;
            }

            // Add description
            if (artworkData.description) {
              captionText +=
                (captionText ? "\n\n" : "") + artworkData.description;
            }

            // Add medium
            if (artworkData.medium) {
              captionText +=
                (captionText ? "\n\n" : "") + "Medium: " + artworkData.medium;
            }

            // Add characters
            if (artworkData.characters && artworkData.characters.length) {
              captionText +=
                (captionText ? "\n\n" : "") +
                "Characters: " +
                artworkData.characters.join(", ");
            }

            // Set all possible caption attributes for maximum compatibility
            link.setAttribute("data-caption", captionText);
            link.setAttribute("data-title", captionText);
            link.setAttribute("title", captionText);
            link.setAttribute("data-description", captionText);

            // SimpleLightbox sometimes uses the img title too
            const img = link.querySelector("img");
            if (img) {
              img.setAttribute("title", captionText);
            }
          } catch (e) {
            console.error("Error processing link caption:", e);
          }
        });

        // Create new lightbox instance with all caption options enabled
        window.lightboxInstance = new SimpleLightbox(".thumbnail a", {
          captionsData: ["caption", "title", "description"], // Try all possible attributes
          captionType: "data", // Use data attributes
          captionPosition: "bottom",
          captionDelay: 0,
          captions: true, // Must be true for captions to show
          captionSelector: "self", // Look for captions on the <a> elements
          docClose: true, // Close when clicking outside
          disableScroll: true, // Prevent scrolling
          alertError: false, // Don't show errors
          history: false, // Don't update browser history
          napText: ["←", "→"],
          closeText: "×",
          showCounter: false,
          animationSpeed: 250,
          animationSlide: true,
          preloading: true,
          enableKeyboard: true,
          loop: true,
          rel: false,
          docClose: true,
          swipeTolerance: 50,
          className: "simple-lightbox",
          widthRatio: 0.8,
          heightRatio: 0.9,
          scaleImageToRatio: false,
          disableRightClick: false,
          disableScroll: true,
          alertError: false,
          alertErrorMessage: "Image not found, next image will be loaded",
          additionalHtml: false,
          history: false,
          throttleInterval: 0,
          doubleTapZoom: 2,
          maxZoom: 10,
          htmlClass: "has-lightbox",
          rtl: false,
          fixedClass: "sl-fixed",
          fadeSpeed: 300,
          uniqueImages: true,
          focus: true,
          scrollZoom: true,
          scrollZoomFactor: 0.5,
          download: false,
        });

        console.log("Custom lightbox initialized");
      }

      // Set up filter functionality
      function setupFilters() {
        const filterButton = document.getElementById("applyFilters");
        if (!filterButton) return;

        filterButton.addEventListener("click", function () {
          // Get all filter values
          const yearFilter = document.getElementById("yearFilter").value;
          const mediumFilter = document.getElementById("mediumFilter").value;
          const characterFilter =
            document.getElementById("characterFilter").value;

          console.log(
            `Filtering - Year: ${yearFilter}, Medium: ${mediumFilter}, Character: ${characterFilter}`
          );

          // Start with all artworks
          let filteredArtworks = window.allArtworks;

          // Apply year filter
          if (yearFilter !== "all") {
            filteredArtworks = filteredArtworks.filter(
              (artwork) => artwork.category === yearFilter
            );
          }

          // Apply medium filter
          if (mediumFilter !== "all") {
            filteredArtworks = filteredArtworks.filter(
              (artwork) => artwork.medium === mediumFilter
            );
          }

          // Apply character filter (arrays need different handling)
          if (characterFilter !== "all") {
            filteredArtworks = filteredArtworks.filter((artwork) => {
              // Handle artwork without characters field
              if (!artwork.characters) return false;

              // Check if character exists in the array
              return artwork.characters.includes(characterFilter);
            });
          }

          // Rerender gallery
          renderGallery(filteredArtworks);
        });
      }

      // Render gallery with filtered artworks
      function renderGallery(artworks) {
        const artworksContainer = document.querySelector(".artworks");
        if (!artworksContainer) return;

        // If no artworks, show a message
        if (!artworks || artworks.length === 0) {
          artworksContainer.innerHTML =
            '<div class="loading-indicator">No artworks that match the filters just yet!</div>';
          return;
        }

        // Group by category
        const categories = {};
        artworks.forEach((artwork) => {
          if (!categories[artwork.category]) {
            categories[artwork.category] = [];
          }
          categories[artwork.category].push(artwork);
        });

        // Clear container
        artworksContainer.innerHTML = "";

        // Categories to display in order
        const orderedCategories = ["2025", "2024", "2023", "2022", "sketches"];

        // Create sections for each category
        orderedCategories.forEach((category) => {
          if (!categories[category] || categories[category].length === 0) {
            return; // Skip empty categories
          }

          // Create year section
          const yearSection = document.createElement("div");
          yearSection.className = "year-section";
          yearSection.id = `year-${category}`;

          // Add header
          const header = document.createElement("h2");
          header.style.textAlign = "center";
          header.style.borderBottom = "1px dashed white";
          header.style.paddingBottom = "5px";
          header.style.margin = "20px 0 15px 0";
          header.textContent =
            category === "sketches" ? "Sketches & Scraps" : category;
          yearSection.appendChild(header);

          // Create thumbnail grid
          const thumbnailGrid = document.createElement("div");
          thumbnailGrid.className = "thumbnail-grid";
          thumbnailGrid.style.display = "grid";
          thumbnailGrid.style.gridTemplateColumns =
            "repeat(auto-fill, minmax(90px, 1fr))";
          thumbnailGrid.style.gap = "15px";
          thumbnailGrid.style.marginBottom = "25px";

          // Add each artwork to the grid
          categories[category].forEach((artwork) => {
            const thumbnail = document.createElement("div");
            thumbnail.className = "thumbnail";

            const link = document.createElement("a");
            link.href = artwork.imageUrl;

            // Store the complete artwork data as a custom attribute
            link.dataset.artworkJson = JSON.stringify({
              id: artwork._id,
              title: artwork.title,
              description: artwork.description,
              medium: artwork.medium,
              characters: artwork.characters,
            });

            const image = document.createElement("img");
            image.src = `${artwork.imageUrl}?w=90&h=90&fit=crop`;
            image.alt = artwork.title || "Artwork";
            image.title = artwork.title || "Artwork";
            image.setAttribute("loading", "lazy");
            image.style.maxWidth = "90px";
            image.style.maxHeight = "90px";
            image.style.width = "100%";
            image.style.height = "auto";
            image.style.aspectRatio = "1 / 1";
            image.style.objectFit = "cover";

            link.appendChild(image);
            thumbnail.appendChild(link);
            thumbnailGrid.appendChild(thumbnail);
          });

          yearSection.appendChild(thumbnailGrid);
          artworksContainer.appendChild(yearSection);
        });

        // Initialize custom lightbox after rendering
        initializeCustomLightbox(artworks);
      }
    </script>

    <script src="/art-mobile.js"></script>

    <style>
      /* Custom caption styles */
      .custom-caption {
        position: fixed;
        bottom: 0;
        left: 0;
        right: 0;
        background-color: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 15px;
        text-align: left;
        z-index: 10005; /* Above everything in the lightbox */
        font-family: "MS Gothic", "MS PGothic", sans-serif;
        line-height: 1.5;
        white-space: pre-line; /* Preserve line breaks */
        display: none; /* Hidden by default */
        max-width: 80%;
        margin: 0 auto 30px auto;
        border-radius: 5px;
      }

      /* Override SimpleLightbox styles to make sure our captions work */
      .sl-overlay {
        z-index: 10000 !important;
      }

      .sl-wrapper {
        z-index: 10001 !important;
      }

      .sl-image {
        z-index: 10002 !important;
      }

      .sl-close {
        z-index: 10003 !important;
      }

      /* Hide the original caption */
      .sl-caption {
        display: none !important;
      }
    </style>

    <script>
      // Wait for the DOM to be fully loaded
      document.addEventListener("DOMContentLoaded", function () {
        // Create a custom caption element
        const customCaption = document.createElement("div");
        customCaption.className = "custom-caption";
        document.body.appendChild(customCaption);

        // Add event listeners to all thumbnail links
        document.querySelectorAll(".thumbnail a").forEach((link) => {
          link.addEventListener("click", function (e) {
            // Get the description from the data attributes
            let captionText = "";

            // Try to get data from various attributes
            if (this.dataset.description) {
              captionText = this.dataset.description;
            } else if (this.dataset.caption) {
              captionText = this.dataset.caption;
            } else if (this.getAttribute("title")) {
              captionText = this.getAttribute("title");
            } else if (this.dataset.artworkJson) {
              try {
                const artworkData = JSON.parse(this.dataset.artworkJson);

                // Build caption from artwork data
                if (artworkData.title) {
                  captionText = artworkData.title;
                }

                if (artworkData.description) {
                  captionText +=
                    (captionText ? "\n\n" : "") + artworkData.description;
                }

                if (artworkData.medium) {
                  captionText +=
                    (captionText ? "\n\n" : "") +
                    "Medium: " +
                    artworkData.medium;
                }

                if (artworkData.characters && artworkData.characters.length) {
                  captionText +=
                    (captionText ? "\n\n" : "") +
                    "Characters: " +
                    artworkData.characters.join(", ");
                }
              } catch (e) {
                console.error("Error parsing artwork data:", e);
              }
            }

            // Store caption text for later use
            this.setAttribute("data-custom-caption", captionText);
          });
        });

        // Create a MutationObserver to detect when SimpleLightbox is opened
        const observer = new MutationObserver(function (mutations) {
          for (const mutation of mutations) {
            if (mutation.addedNodes.length) {
              // Check if SimpleLightbox has been added to the DOM
              if (document.querySelector(".sl-overlay")) {
                showCustomCaption();
              }
            }

            if (mutation.removedNodes.length) {
              // Check if SimpleLightbox has been removed from the DOM
              if (!document.querySelector(".sl-overlay")) {
                hideCustomCaption();
              }
            }
          }
        });

        // Start observing the document body for changes
        observer.observe(document.body, { childList: true, subtree: true });

        // Function to show our custom caption
        function showCustomCaption() {
          // Find the current image in the lightbox
          const currentImage = document.querySelector(".sl-image img");
          if (!currentImage) return;

          // Find the original thumbnail link that opened this image
          const thumbnailLinks = document.querySelectorAll(".thumbnail a");
          let captionText = "";

          thumbnailLinks.forEach((link) => {
            // Check if this is the link for the current image
            if (
              link.href === currentImage.src ||
              currentImage.src.startsWith(link.href) ||
              link.href.includes(currentImage.src.split("?")[0])
            ) {
              // Get caption from our custom attribute
              captionText = link.getAttribute("data-custom-caption") || "";

              // If we couldn't find it there, try other attributes
              if (!captionText) {
                if (link.dataset.description) {
                  captionText = link.dataset.description;
                } else if (link.getAttribute("title")) {
                  captionText = link.getAttribute("title");
                }
              }
            }
          });

          // If we found a caption, show it
          if (captionText) {
            customCaption.textContent = captionText;
            customCaption.style.display = "block";
          }
        }

        // Function to hide our custom caption
        function hideCustomCaption() {
          customCaption.style.display = "none";
        }

        // Also try to detect SimpleLightbox navigation events
        document.addEventListener("click", function (e) {
          // Wait a moment for the new image to load
          setTimeout(showCustomCaption, 300);
        });
      });
    </script>
  </body>
</html>
