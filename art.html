<!DOCTYPE html>
<html>
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link href="/index.css" rel="stylesheet" type="text/css" media="all" />
    <link href="/gallery.css" rel="stylesheet" type="text/css" media="all" />
    <link href="/mobile.css" rel="stylesheet" type="text/css" media="all" />
    <title>Art Gallery | luck</title>
    <link rel="icon" type="image/x-icon" href=" " />

    <!-- SimpleLightbox for image gallery -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/simplelightbox/2.12.1/simple-lightbox.min.css"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/simplelightbox/2.12.1/simple-lightbox.min.js"></script>

    <!-- Sanity Client Setup -->
    <script>
      // Include this script to load the ESM module
      window.global = window;
    </script>
    <script type="module">
      import { createClient } from "https://esm.sh/@sanity/client";
      window.createClient = createClient;
      // Signal that Sanity client is loaded
      window.sanityClientLoaded = true;
    </script>

    <!-- Centralized transitions -->
    <script src="/transitions.js"></script>

    <style>
      /* Critical styles for immediate application */
      .mainframe {
        overflow-y: scroll !important;
        height: 500px !important;
        width: 680px !important;
      }

      .sideframe {
        overflow-y: auto !important;
        overflow-x: hidden !important;
        height: 500px !important;
      }

      /* Special styling for right sideframe in art gallery only */
      .art-gallery-right-sideframe {
        width: 5px !important;
        border-left: none !important;
        background-color: black !important;
        opacity: 0 !important;
        pointer-events: none !important;
      }

      /* Ensure left sideframe is proper width */
      .left-sideframe {
        width: 175px !important;
      }

      /* IMPORTANT: Force dotted borders on sections */
      .left-section:not(.left-bottom-section) {
        border-bottom: 1px dashed white !important;
      }

      /* Force proper text spacing */
      p {
        margin-top: 0.5em !important;
        margin-bottom: 0.5em !important;
      }

      /* Year sections with forced dotted underlines */
      .year-section h2 {
        text-align: center !important;
        border-bottom: 1px dashed white !important;
        padding-bottom: 5px !important;
        margin: 20px 0 15px 0 !important;
      }

      /* Gallery title */
      .gallery-title {
        text-align: center !important;
        margin-bottom: 20px !important;
        font-size: 1.5em !important;
      }

      /* Filter box styles */
      .filters {
        margin: 10px 0 !important;
        padding: 10px !important;
        border: 1px dashed #666 !important;
        text-align: center !important;
        min-height: 100px !important;
      }

      /* Thumbnail grid layout */
      .thumbnail-grid {
        display: grid !important;
        grid-template-columns: repeat(auto-fill, minmax(90px, 1fr)) !important;
        gap: 15px !important;
        margin-bottom: 25px !important;
      }

      /* Force thumbnail images to display properly */
      .thumbnail img {
        max-width: 90px !important;
        max-height: 90px !important;
        width: 100% !important;
        height: auto !important;
        aspect-ratio: 1 / 1 !important;
        object-fit: cover !important;
      }

      /* Loading indicator and error messages */
      .loading-indicator,
      .error-message {
        padding: 20px;
        text-align: center;
        color: white;
      }

      .error-message {
        color: #ff6b6b;
      }

      /* Header placeholder - Style if needed */
      .header02 {
        width: 438px;
        height: 215px;
        margin: 5px auto;
      }
    </style>
  </head>

  <body>
    <div class="header02">
      <a href="/"> <img src="" /> </a>
    </div>

    <div class="banner"></div>

    <main>
      <div class="mainwrapper">
        <!-- Keep the original flex layout structure to match other pages -->
        <div style="display: flex">
          <!-- Left sideframe -->
          <div class="sideframe left-sideframe">
            <div
              class="left-section left-top-section filter-section"
              style="border-bottom: 1px dashed white !important"
            >
              <center><h3 id="h3navmargins">Filters</h3></center>
              <div class="sidecontent">
                <section
                  class="filters"
                  style="
                    margin: 10px 0 !important;
                    padding: 10px !important;
                    border: 1px dashed #666 !important;
                    text-align: center !important;
                    min-height: 100px !important;
                  "
                >
                  <div>
                    <label>Year:</label>
                    <select id="yearFilter">
                      <option value="all">All Years</option>
                      <option value="2025">2025</option>
                      <option value="2024">2024</option>
                      <option value="2023">2023</option>
                      <option value="2022">2022</option>
                      <option value="sketches">Sketches</option>
                    </select>
                  </div>
                  <div style="margin-top: 10px">
                    <button
                      id="applyFilters"
                      style="
                        margin-top: 10px;
                        padding: 5px 10px;
                        background: #333;
                        color: white;
                        border: 1px solid white;
                        cursor: pointer;
                      "
                    >
                      Apply Filters
                    </button>
                  </div>
                </section>
              </div>
            </div>

            <div class="left-section left-bottom-section">
              <center></center>
              <div class="sidecontent">
                <center>
                  <div style="margin: 0px 0">
                    <a
                      href="/"
                      style="display: inline-block"
                      class="about-link"
                      title="Wah!"
                    >
                      <img
                        src="/bnuuy_closed.png"
                        alt="Home"
                        class="icon-default"
                        style="
                          width: 75px;
                          height: 103px;
                          vertical-align: middle;
                        "
                      />
                      <img
                        src="/bnuuy_open.png"
                        alt="Home Hover"
                        class="icon-hover"
                        style="
                          width: 75px;
                          height: 103px;
                          display: none;
                          vertical-align: middle;
                        "
                      />
                    </a>
                  </div>
                  <div
                    class="quick-links"
                    style="text-align: left; margin-top: 15px"
                  >
                    <p
                      style="
                        margin-top: 0.5em !important;
                        margin-bottom: 0.5em !important;
                      "
                    >
                      <img
                        src="/aboutmeee.png"
                        style="height: 15px"
                        alt="icon"
                      />
                      <a href="/aboutme.html">About me</a><br />
                      <img
                        src="/paperr.png"
                        style="height: 15px; vertical-align: middle"
                        alt="icon"
                      />
                      <a href="/journal.html">Journal</a><br />
                      <img
                        src="/musicc.png"
                        style="height: 15px; vertical-align: middle"
                        alt="icon"
                      />
                      <a href="/music.html">Music</a> <br />
                      <img
                        src="/chatt.png"
                        style="height: 15px; vertical-align: middle"
                        alt="icon"
                      />
                      <a
                        href="http://users.smartgb.com/g/g.php?a=s&i=g19-00984-40"
                        target="_blank"
                        >Guestbook</a
                      >
                    </p>
                  </div>
                </center>
              </div>
            </div>
          </div>

          <!-- Mainframe with wider width -->
          <div class="mainframe" style="width: 680px !important">
            <div class="maincontent gallery-content">
              <h2
                class="gallery-title"
                style="
                  text-align: center !important;
                  margin-bottom: 20px !important;
                  font-size: 1.5em !important;
                "
              >
                luck's art archive
              </h2>

              <section class="artworks">
                <!-- Dynamic content will be loaded by the gallery script -->
                <div class="loading-indicator">Loading gallery...</div>
              </section>
            </div>
          </div>

          <!-- Camouflaged right sideframe (empty but preserves layout structure) -->
          <div class="sideframe art-gallery-right-sideframe">
            <!-- Intentionally empty -->
          </div>
        </div>
      </div>
    </main>
    <footer>
      <p id="paragraphstyling"><small> luck est. 2023 </small></p>
    </footer>

    <script>
      // Wait for Sanity client
      function waitForSanity(callback) {
        if (window.createClient) {
          callback();
        } else {
          console.log("Waiting for Sanity client to load...");
          setTimeout(() => waitForSanity(callback), 100);
        }
      }

      // Initialize gallery
      document.addEventListener("DOMContentLoaded", function () {
        waitForSanity(() => {
          // Get container
          const artworksContainer = document.querySelector(".artworks");

          try {
            // Create Sanity client
            const client = window.createClient({
              projectId: "asrslodd",
              dataset: "production",
              apiVersion: "2025-05-03",
              useCdn: true,
            });

            // Query to fetch artworks
            const query = `*[_type == "artwork"] {
              _id,
              title,
              "imageUrl": image.asset->url,
              year,
              description,
              category
            } | order(year desc)`;

            // Fetch artworks
            client
              .fetch(query)
              .then((artworks) => {
                // Store for filtering
                window.allArtworks = artworks;

                // Group by category
                const categories = {};
                artworks.forEach((artwork) => {
                  if (!categories[artwork.category]) {
                    categories[artwork.category] = [];
                  }
                  categories[artwork.category].push(artwork);
                });

                // Clear container
                artworksContainer.innerHTML = "";

                // Categories to display in order
                const orderedCategories = [
                  "2025",
                  "2024",
                  "2023",
                  "2022",
                  "sketches",
                ];

                // Create sections for each category
                orderedCategories.forEach((category) => {
                  if (
                    !categories[category] ||
                    categories[category].length === 0
                  ) {
                    return; // Skip empty categories
                  }

                  // Create year section
                  const yearSection = document.createElement("div");
                  yearSection.className = "year-section";
                  yearSection.id = `year-${category}`;

                  // Add header
                  const header = document.createElement("h2");
                  header.style.textAlign = "center";
                  header.style.borderBottom = "1px dashed white";
                  header.style.paddingBottom = "5px";
                  header.style.margin = "20px 0 15px 0";
                  header.textContent =
                    category === "sketches" ? "Sketches & Scraps" : category;
                  yearSection.appendChild(header);

                  // Create thumbnail grid
                  const thumbnailGrid = document.createElement("div");
                  thumbnailGrid.className = "thumbnail-grid";
                  thumbnailGrid.style.display = "grid";
                  thumbnailGrid.style.gridTemplateColumns =
                    "repeat(auto-fill, minmax(90px, 1fr))";
                  thumbnailGrid.style.gap = "15px";
                  thumbnailGrid.style.marginBottom = "25px";

                  // Add each artwork to the grid
                  categories[category].forEach((artwork) => {
                    const thumbnail = document.createElement("div");
                    thumbnail.className = "thumbnail";

                    const link = document.createElement("a");
                    link.href = artwork.imageUrl;
                    link.dataset.description = artwork.description || "";

                    const image = document.createElement("img");
                    image.src = `${artwork.imageUrl}?w=90&h=90&fit=crop`;
                    image.alt = artwork.title;
                    image.title = artwork.title;
                    image.setAttribute("loading", "lazy");
                    image.style.maxWidth = "90px";
                    image.style.maxHeight = "90px";
                    image.style.width = "100%";
                    image.style.height = "auto";
                    image.style.aspectRatio = "1 / 1";
                    image.style.objectFit = "cover";

                    link.appendChild(image);
                    thumbnail.appendChild(link);
                    thumbnailGrid.appendChild(thumbnail);
                  });

                  yearSection.appendChild(thumbnailGrid);
                  artworksContainer.appendChild(yearSection);
                });

                // Initialize lightbox
                if (typeof SimpleLightbox !== "undefined") {
                  setTimeout(() => {
                    new SimpleLightbox(".thumbnail a", {
                      captionsData: "description",
                      captionDelay: 0,
                      captionPosition: "bottom",
                      animationSpeed: 300,
                      fadeSpeed: 300,
                      overlay: true,
                      overlayOpacity: 0.9,
                      navText: ["←", "→"],
                      closeText: "×",
                      showCounter: false,
                    });
                  }, 100);
                }

                // Set up filtering
                setupFilters();
              })
              .catch((error) => {
                console.error("Error fetching artworks:", error);
                artworksContainer.innerHTML =
                  '<div class="error-message">Error loading gallery. Please try again later.</div>';
              });
          } catch (error) {
            console.error("Exception in gallery script:", error);
            artworksContainer.innerHTML =
              '<div class="error-message">An error occurred while setting up the gallery. Please check the console for details.</div>';
          }
        });
      });

      // Set up filter functionality
      function setupFilters() {
        const filterButton = document.getElementById("applyFilters");
        if (!filterButton) return;

        filterButton.addEventListener("click", function () {
          const yearFilter = document.getElementById("yearFilter").value;

          // Get artworks
          let filteredArtworks = window.allArtworks;

          // Apply year filter
          if (yearFilter !== "all") {
            filteredArtworks = filteredArtworks.filter(
              (artwork) => artwork.category === yearFilter
            );
          }

          // Rerender gallery
          renderGallery(filteredArtworks);
        });
      }

      // Render gallery with filtered artworks
      function renderGallery(artworks) {
        const artworksContainer = document.querySelector(".artworks");
        if (!artworksContainer) return;

        // If no artworks, show a message
        if (!artworks || artworks.length === 0) {
          artworksContainer.innerHTML =
            '<div class="loading-indicator">No artworks found that match your filters.</div>';
          return;
        }

        // Group by category
        const categories = {};
        artworks.forEach((artwork) => {
          if (!categories[artwork.category]) {
            categories[artwork.category] = [];
          }
          categories[artwork.category].push(artwork);
        });

        // Clear container
        artworksContainer.innerHTML = "";

        // Categories to display in order
        const orderedCategories = ["2025", "2024", "2023", "2022", "sketches"];

        // Create sections for each category
        orderedCategories.forEach((category) => {
          if (!categories[category] || categories[category].length === 0) {
            return; // Skip empty categories
          }

          // Create year section
          const yearSection = document.createElement("div");
          yearSection.className = "year-section";
          yearSection.id = `year-${category}`;

          // Add header
          const header = document.createElement("h2");
          header.style.textAlign = "center";
          header.style.borderBottom = "1px dashed white";
          header.style.paddingBottom = "5px";
          header.style.margin = "20px 0 15px 0";
          header.textContent =
            category === "sketches" ? "Sketches & Scraps" : category;
          yearSection.appendChild(header);

          // Create thumbnail grid
          const thumbnailGrid = document.createElement("div");
          thumbnailGrid.className = "thumbnail-grid";
          thumbnailGrid.style.display = "grid";
          thumbnailGrid.style.gridTemplateColumns =
            "repeat(auto-fill, minmax(90px, 1fr))";
          thumbnailGrid.style.gap = "15px";
          thumbnailGrid.style.marginBottom = "25px";

          // Add each artwork to the grid
          categories[category].forEach((artwork) => {
            const thumbnail = document.createElement("div");
            thumbnail.className = "thumbnail";

            const link = document.createElement("a");
            link.href = artwork.imageUrl;
            link.dataset.description = artwork.description || "";

            const image = document.createElement("img");
            image.src = `${artwork.imageUrl}?w=90&h=90&fit=crop`;
            image.alt = artwork.title;
            image.title = artwork.title;
            image.setAttribute("loading", "lazy");
            image.style.maxWidth = "90px";
            image.style.maxHeight = "90px";
            image.style.width = "100%";
            image.style.height = "auto";
            image.style.aspectRatio = "1 / 1";
            image.style.objectFit = "cover";

            link.appendChild(image);
            thumbnail.appendChild(link);
            thumbnailGrid.appendChild(thumbnail);
          });

          yearSection.appendChild(thumbnailGrid);
          artworksContainer.appendChild(yearSection);
        });

        // Initialize lightbox
        if (typeof SimpleLightbox !== "undefined") {
          setTimeout(() => {
            new SimpleLightbox(".thumbnail a", {
              captionsData: "description",
              captionDelay: 0,
              captionPosition: "bottom",
              animationSpeed: 300,
              fadeSpeed: 300,
              overlay: true,
              overlayOpacity: 0.9,
              navText: ["←", "→"],
              closeText: "×",
              showCounter: false,
            });
          }, 100);
        }
      }
    </script>

    <!-- Responsive layout fixes for art gallery -->
    <style id="responsive-art-gallery-fix">
      /* DESKTOP STYLES - Ensure flex layout is preserved */
      @media screen and (min-width: 768px) {
        /* Enforce horizontal layout on desktop */
        .mainwrapper > div {
          display: flex !important;
        }

        /* Maintain correct width for mainframe on desktop */
        .mainframe {
          width: 680px !important;
          flex-grow: 1 !important;
          flex-basis: 680px !important;
        }

        /* Maintain correct width for left sideframe */
        .sideframe.left-sideframe {
          width: 175px !important;
          flex-shrink: 0 !important;
          flex-basis: 175px !important;
        }
      }

      /* MOBILE STYLES - Apply only below 767px width */
      @media screen and (max-width: 767px) {
        /* Force layout to stack vertically */
        .mainwrapper > div {
          display: block !important;
        }

        /* Fix all frames */
        .sideframe,
        .mainframe {
          width: 100% !important;
          float: none !important;
          margin: 0 0 10px 0 !important;
        }

        /* Fix mainframe to ensure it fits the screen width */
        .mainframe {
          overflow-x: hidden !important;
          overflow-y: visible !important;
          height: auto !important;
        }

        /* Fix left sideframe - properly expand with all content */
        .sideframe.left-sideframe {
          height: auto !important;
          min-height: auto !important;
          overflow: visible !important;
        }

        /* Hide right sideframe */
        .sideframe:not(.left-sideframe),
        .art-gallery-right-sideframe {
          display: none !important;
        }

        /* Center filter box */
        .filters {
          width: 90% !important;
          max-width: 280px !important;
          margin: 10px auto !important;
        }

        /* Fix thumbnail grid */
        .thumbnail-grid {
          display: grid !important;
          grid-template-columns: repeat(auto-fit, minmax(70px, 1fr)) !important;
          width: 100% !important;
          gap: 8px !important;
          padding: 0 5px !important;
        }

        /* Fix icon sizes in navigation */
        .quick-links img,
        .left-sideframe .quick-links img,
        .sidecontent .quick-links img {
          height: 15px !important;
          width: auto !important;
          max-height: 15px !important;
          vertical-align: middle !important;
        }

        /* Ensure proper spacing around links */
        .quick-links p,
        .left-sideframe .quick-links p {
          line-height: 1.8 !important;
          margin: 0 !important;
          text-align: left !important;
        }
      }
    </style>

    <!-- Simple script to ensure correct layout on resize -->
    <script>
      // Execute on page load and resize
      function applyLayoutFixes() {
        var isDesktop = window.innerWidth >= 768;
        var mainWrapper = document.querySelector(".mainwrapper > div");

        if (mainWrapper) {
          // Apply the correct display style based on screen width
          if (isDesktop) {
            mainWrapper.style.display = "flex";
          } else {
            mainWrapper.style.display = "block";
          }
        }
      }

      // Run on load
      window.addEventListener("load", applyLayoutFixes);

      // Run on resize
      window.addEventListener("resize", applyLayoutFixes);
    </script>
  </body>
</html>
